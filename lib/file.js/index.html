<!doctype html>
<html>
  <head>
    <title>lib/file.js</title>
    <link rel="stylesheet" href="./../../public/style.css" />
    <link rel="icon" type="image/png" href="./../../public/favicon-32.png" />
    <link rel="icon" type="image/png" href="./../../public/favicon-64.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="./../../public/jquery.min.js"></script>
    <script src="./../../public/script.js"></script>
  </head>
  <body class="code">
    
    <main id="sections">

      <!-- The header -->

        
      <section class="section header files-hidden" id="header">

        <aside class="comment">

          <header>

            <div class="file-path">
              
              
              <a id="project-overview" href="./../.." title="Project Overview">Indoc<span id="version">0.4.19</span></a>
              
              <div class="files-menu">
                <span id="filename" title="lib/file.js">lib/file.js</span>
                
              
                <ul class="files hidable">
                  
                  
<li class="file">
  
<a href="../../CHANGELOG.md" title="CHANGELOG.md">
    
<span class="language" style="background-color: transparent">MD</span>


<span class="filename">CHANGELOG.md</span>

</a>

</li>
  
<li class="file">
  
<a href="../../MARKDOWN.md" title="MARKDOWN.md">
    
<span class="language" style="background-color: transparent">MD</span>


<span class="filename">MARKDOWN.md</span>

</a>

</li>
<li class="file separator">
  
  
<a href="../../bin/main.js" title="bin/main.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">bin/main.js</span>

</a>

</li>
<li class="file separator">
  
  
<a href="../../examples/example.c" title="examples/example.c">
    
<span class="language" style="background-color: #555555">C</span>


<span class="filename">examples/example.c</span>

</a>

</li>
  
<li class="file">
  
<a href="../../examples/example.html" title="examples/example.html">
    
<span class="language" style="background-color: #e44b23">HTML</span>


<span class="filename">examples/example.html</span>

</a>

</li>
  
<li class="file">
  
<a href="../../examples/example-with-really-really-long-filename.java" title="examples/example-with-really-really-long-filename.java">
    
<span class="language" style="background-color: #b07219">java</span>


<span class="filename">examples/example-with-really-really-long-filename.java</span>

</a>

</li>
  
<li class="file">
  
<a href="../../examples/example.js" title="examples/example.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">examples/example.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../../examples/example.md" title="examples/example.md">
    
<span class="language" style="background-color: transparent">MD</span>


<span class="filename">examples/example.md</span>

</a>

</li>
  
<li class="file">
  
<a href="../../examples/example.s" title="examples/example.s">
    
<span class="language" style="background-color: #6E4C13">ASM</span>


<span class="filename">examples/example.s</span>

</a>

</li>
<li class="file separator">
  
  
<a href="../class.js" title="lib/class.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/class.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../events.js" title="lib/events.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/events.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../language.js" title="lib/language.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/language.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../main.js" title="lib/main.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/main.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../section.js" title="lib/section.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/section.js</span>

</a>

</li>
<li class="file separator">
  
  
<a href="../public/script.js" title="lib/public/script.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/public/script.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/code.scss" title="lib/public/code.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/code.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/footer.scss" title="lib/public/footer.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/footer.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/header.scss" title="lib/public/header.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/header.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/markdown.scss" title="lib/public/markdown.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/markdown.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/reset.scss" title="lib/public/reset.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/reset.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/section.scss" title="lib/public/section.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/section.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/style.scss" title="lib/public/style.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/style.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/values.scss" title="lib/public/values.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/values.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/version.scss" title="lib/public/version.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/version.scss</span>

</a>

</li>
<li class="file separator">
  
  
<a href="../template/file.html" title="lib/template/file.html">
    
<span class="language" style="background-color: #e44b23">HTML</span>


<span class="filename">lib/template/file.html</span>

</a>

</li>
  
<li class="file">
  
<a href="../template/link.html" title="lib/template/link.html">
    
<span class="language" style="background-color: #e44b23">HTML</span>


<span class="filename">lib/template/link.html</span>

</a>

</li>
  
<li class="file">
  
<a href="../template/page.html" title="lib/template/page.html">
    
<span class="language" style="background-color: #e44b23">HTML</span>


<span class="filename">lib/template/page.html</span>

</a>

</li>
  
<li class="file">
  
<a href="../template/section.html" title="lib/template/section.html">
    
<span class="language" style="background-color: #e44b23">HTML</span>


<span class="filename">lib/template/section.html</span>

</a>

</li>

                  
                </ul>
                
              </div>
                
            </div>

            <div class="spacer"></div>
            
            
          </header>
            
        </aside>

        
        <div class="code empty">
        </div>

      </section>

      <!-- The main code section -->
      
      <section class="section">

  
  <aside class="comment empty">
    <div class="text markdown"></div>
  </aside>

  <div class="code">
    <pre><code><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-extra'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> merge = <span class="hljs-built_in">require</span>(<span class="hljs-string">'merge'</span>);

<span class="hljs-keyword">const</span> auto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'run-auto'</span>);
<span class="hljs-keyword">const</span> section = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./section'</span>).section;
<span class="hljs-keyword">const</span> Language = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./language'</span>).Language;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">File</span> </span>{</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>The file needs access to the <code>project</code> for options and the
templates.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  <span class="hljs-keyword">constructor</span>(project, filename, contents) {
    <span class="hljs-keyword">this</span>.project = project;
    
    <span class="hljs-keyword">this</span>.filename = filename;
    <span class="hljs-keyword">this</span>.path = filename;
    
    <span class="hljs-keyword">this</span>.contents = contents;

    <span class="hljs-keyword">this</span>.index = <span class="hljs-literal">false</span>;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>See <a href="../section.js/" title="">section.js</a></p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">this</span>.sections = [];</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>The final output HTML file.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">this</span>.html = <span class="hljs-string">''</span>;

    <span class="hljs-keyword">this</span>.default_template_data = merge(<span class="hljs-keyword">this</span>.project.default_template_data, {});
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Does nothing at the moment.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  preprocess_file(data, callback) {
    callback(<span class="hljs-literal">null</span>, data);
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Split up the input by newlines and call the callback.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  split_lines(data, callback) {
    <span class="hljs-keyword">var</span> lines = data.split(<span class="hljs-regexp">/\r?\n/</span>);

    callback(<span class="hljs-literal">null</span>, lines);
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Detect the programming language. (Currently, only uses the file
extension.)</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  detect_language(data, callback) {
    <span class="hljs-keyword">this</span>.language = <span class="hljs-keyword">new</span> Language(<span class="hljs-keyword">this</span>.project, <span class="hljs-keyword">this</span>);
    callback(<span class="hljs-literal">null</span>, <span class="hljs-keyword">this</span>.language);
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>The meat of the program: parsing lines.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  parse_lines(data, lang, callback) {</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>See <a href="../section.js/" title="">section.js</a>.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">var</span> sections = [];

    <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add_section</span>(<span class="hljs-params"></span>) </span>{</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>We don&#39;t want to create a new section if the current one is empty anyway.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>      <span class="hljs-keyword">if</span>(sections.length == <span class="hljs-number">0</span> || !current_section().is_empty()) {
        sections.push(section.create(scope.project, scope, lang));
      }
      
    }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Start off with an empty section.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    add_section();</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Just a convenience function.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">current_section</span>(<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> sections[sections.length<span class="hljs-number">-1</span>];
    }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p><code>in_comment</code> is self explanatory. That&#39;s why I&#39;m explaining it
to you right now by saying it&#39;s self explanatory. Hey, if I was
smart, I&#39;d be working at <a href="http://www.spacex.com/" title="">SpaceX</a>. Or
something.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">var</span> in_comment = <span class="hljs-literal">false</span>,
        in_multi = <span class="hljs-literal">false</span>,
        line,
        comment,
        i;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p><code>for(line in data) { ...</code></p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;data.length; i++) {
      line = data[i];</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>... if that line is a comment...</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>      <span class="hljs-keyword">if</span>(lang.is_comment(line) || in_multi) {

        <span class="hljs-keyword">if</span>(lang.starts_multi_comment(line) &amp;&amp; !lang.ends_multi_comment(line))
          in_multi = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(lang.ends_multi_comment(line))
          in_multi = <span class="hljs-literal">false</span>;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>... then strip the whitespace from it...</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>        comment = lang.strip_comment(line);</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>... and add a new section, if necessary.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>        <span class="hljs-keyword">if</span>(!in_comment)
          add_section();</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Then append the line to the current section&#39;s comment, with
a newline (to replace the one lost with the split, above.)</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>        current_section().comment += comment + <span class="hljs-string">'\n'</span>;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>We&#39;re obviously in a comment now.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>        in_comment = <span class="hljs-literal">true</span>;
        
      } <span class="hljs-keyword">else</span> {
        
        in_comment = <span class="hljs-literal">false</span>;
        in_multi = <span class="hljs-literal">false</span>;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>This is a bit strange: if we&#39;re currently on our first
section, <em>and</em> the code is empty, <em>and</em> the line is empty,
then ignore it.  Basically, this chops off the whitespace
at the start of a file.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>        <span class="hljs-keyword">if</span>(sections.length == <span class="hljs-number">1</span> &amp;&amp; !current_section().code.trim() &amp;&amp; !line.trim()) <span class="hljs-keyword">continue</span>;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>If there&#39;s a space after the comment, we want to ignore
it. (Otherwise, the tops of the code and the comments won&#39;t
be lined up and it&#39;ll be harder to match them up.)</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>        <span class="hljs-keyword">if</span>(!current_section().code.trim() &amp;&amp; !line.trim()) <span class="hljs-keyword">continue</span>;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Same as above: we need to replace the missing newline.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>        current_section().code += line + <span class="hljs-string">'\n'</span>;
      }
      
    };</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>This just syntax-highlights the code and converts the Markdown
comments to HTML.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;sections.length; i++) {
      sections[i].done();
    }

    <span class="hljs-keyword">this</span>.sections = sections;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>And we&#39;re done here! Whew.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    callback(<span class="hljs-literal">null</span>, sections);
    
  }

  get_rel_path() {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'./'</span> + path.relative(<span class="hljs-string">'/'</span> + <span class="hljs-keyword">this</span>.get_link(), <span class="hljs-string">'/'</span>);
  }

  get_rel_link(link) {
    <span class="hljs-keyword">return</span> path.relative(<span class="hljs-keyword">this</span>.get_rel_path(), link);
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>This function just invokes Hogan.js to produce the HTML output.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  render(sections, language, callback) {
    
    <span class="hljs-keyword">if</span>(!language) language = <span class="hljs-keyword">this</span>.language;

    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">this</span>.sections.length; i++) {
      <span class="hljs-keyword">this</span>.sections[i].done();
    }

    <span class="hljs-keyword">var</span> i;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Relative path to the output root, in filesystem-space.  For the
file <code>docs/foo/bar/</code>, <code>rel_path</code> would be <code>./../../</code>. It&#39;s used
for inter-file linking and CSS/JS.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">this</span>.default_template_data.path = <span class="hljs-keyword">this</span>.get_rel_path();</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Get a list of all of the other files&#39; filenames and URLs except
this one.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">var</span> filenames = <span class="hljs-keyword">this</span>.project.get_link_filenames(<span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">var</span> md = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.sections.length == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-keyword">this</span>.sections[<span class="hljs-number">0</span>].code_is_markdown) {
      md = <span class="hljs-keyword">this</span>.sections[<span class="hljs-number">0</span>].code_highlighted;
    }

    <span class="hljs-keyword">var</span> classes = [];

    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.index) classes.push(<span class="hljs-string">'index'</span>);
    
    <span class="hljs-keyword">if</span>(md) classes.push(<span class="hljs-string">'markdown'</span>);
    <span class="hljs-keyword">else</span>   classes.push(<span class="hljs-string">'code'</span>);

    <span class="hljs-keyword">var</span> html_sections = <span class="hljs-string">''</span>;

    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">this</span>.sections.length; i++) {
      html_sections += <span class="hljs-keyword">this</span>.sections[i].render();
    }

    <span class="hljs-keyword">var</span> html_filenames = <span class="hljs-string">''</span>;

    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;filenames.length; i++) {
      html_filenames += <span class="hljs-keyword">this</span>.project.templates.file.render(merge(<span class="hljs-keyword">this</span>.default_template_data, filenames[i]));
    }

    <span class="hljs-keyword">var</span> html_links = <span class="hljs-string">''</span>;

    <span class="hljs-keyword">var</span> links = <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.project.options.links).sort();

    <span class="hljs-keyword">var</span> type_names = {
      <span class="hljs-attr">github</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">"GitHub"</span>,
        <span class="hljs-attr">desc</span>: <span class="hljs-string">"View on GitHub"</span>
      },
      <span class="hljs-attr">twitter</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">"Twitter"</span>,
        <span class="hljs-attr">desc</span>: <span class="hljs-string">"Follow on Twitter"</span>
      },
      <span class="hljs-attr">home</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">"Homepage"</span>,
        <span class="hljs-attr">desc</span>: <span class="hljs-string">"Project homepage"</span>
      }
    };

    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;links.length; i++) {
      <span class="hljs-keyword">var</span> type = links[i]
      <span class="hljs-keyword">var</span> link = <span class="hljs-keyword">this</span>.project.options.links[type];

      <span class="hljs-keyword">if</span>(!(type <span class="hljs-keyword">in</span> type_names)) {
        <span class="hljs-keyword">this</span>.project.fire(<span class="hljs-string">'link-type-unknown'</span>, type);
        <span class="hljs-keyword">continue</span>;
      }
      
      html_links += <span class="hljs-keyword">this</span>.project.templates.link.render({
        <span class="hljs-attr">url</span>: link,
        <span class="hljs-attr">name</span>: type_names[type].name,
        <span class="hljs-attr">desc</span>: type_names[type].desc,
        <span class="hljs-attr">type</span>: type
      });
    }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>HOGAN, DO YOUR THING!</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">this</span>.html = <span class="hljs-keyword">this</span>.project.templates.page.render(merge(<span class="hljs-keyword">this</span>.default_template_data, {
      <span class="hljs-attr">title</span>: (<span class="hljs-keyword">this</span>.index ? <span class="hljs-keyword">this</span>.project.options.name : <span class="hljs-keyword">this</span>.filename),
      <span class="hljs-attr">version</span>: <span class="hljs-keyword">this</span>.project.options.version,
      <span class="hljs-attr">language</span>: <span class="hljs-keyword">this</span>.language.name.human,
      <span class="hljs-attr">markdown</span>: md,
      <span class="hljs-attr">index</span>: <span class="hljs-keyword">this</span>.index,
      <span class="hljs-attr">filename</span>: <span class="hljs-keyword">this</span>.filename,
      <span class="hljs-attr">files</span>: html_filenames,
      <span class="hljs-attr">classes</span>: classes.join(<span class="hljs-string">' '</span>),
      <span class="hljs-attr">sections</span>: html_sections,
      <span class="hljs-attr">links</span>: html_links
    }));

    callback(<span class="hljs-literal">null</span>, <span class="hljs-keyword">this</span>.html);
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Get the output filename, in filesystem-space. For <code>bin/main.js</code>,
this returns <code>docs/bin/main.js/index.html</code></p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  get_output_filename() {
    <span class="hljs-keyword">return</span> path.join(<span class="hljs-keyword">this</span>.project.options.output, <span class="hljs-keyword">this</span>.path, <span class="hljs-string">'index.html'</span>);
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Same as above, but server-space. With <code>bin/main.js</code>, this returns
<code>bin/main.js/</code>. It&#39;s used for pretty links in <code>&lt;a&gt;</code> tags.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  get_link() {
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.index) <span class="hljs-keyword">return</span> <span class="hljs-string">'./'</span>;
    <span class="hljs-keyword">return</span> path.join(<span class="hljs-keyword">this</span>.path, <span class="hljs-string">'/'</span>);
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Write the generated file.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  write(callback) {

    <span class="hljs-keyword">var</span> filename = <span class="hljs-keyword">this</span>.get_output_filename();

    <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>;

    fs.mkdirs(path.dirname(filename), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
      <span class="hljs-keyword">if</span>(err) {
        callback(err, <span class="hljs-literal">null</span>);
        <span class="hljs-keyword">return</span>;
      }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Yeah, yeah, I know, callback hell. What&#39;s the harm in using it once?</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>      fs.writeFile(filename, scope.html, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
        
        <span class="hljs-keyword">if</span>(err) {
          callback(err, <span class="hljs-literal">null</span>);
          <span class="hljs-keyword">return</span>;
        }

        callback(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);

      });      
      
    });


  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>A mega-function that calls most of the above functions, in the
proper order thanks to <code>run-auto</code>.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  parse_file(err, data, callback) {

    <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>This is weird. I&#39;m not sure why it&#39;s here instead of up there,
but I&#39;m sure there&#39;s some reason. I don&#39;t change strange things
like this when I find them for fear of causing my programs to
explode with errors.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">if</span>(err) {
      callback(err, <span class="hljs-keyword">this</span>);
      <span class="hljs-keyword">return</span>;
    }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>See above: <code>var auto = require(&#39;run-auto&#39;);</code></p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    auto({
      
      <span class="hljs-attr">preprocess</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        scope.preprocess_file.call(scope, data, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{

          next(err, data);
          
        });
      },
      
      <span class="hljs-attr">split_lines</span>: [<span class="hljs-string">'preprocess'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next, results</span>) </span>{
        
        scope.split_lines.call(scope, results.preprocess, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
          
          next(err, data);
          
        });
          
      }],
      
      <span class="hljs-attr">language</span>: [<span class="hljs-string">'preprocess'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next, results</span>) </span>{
        
        scope.detect_language.call(scope, results.preprocess, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
          
          next(err, data);
          
        });
          
      }],
      
      <span class="hljs-attr">parse_lines</span>: [<span class="hljs-string">'split_lines'</span>, <span class="hljs-string">'language'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next, results</span>) </span>{

        scope.parse_lines.call(scope, results.split_lines, results.language, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
          
          next(err, data);
          
        });
          
      }],
      
      <span class="hljs-attr">render</span>: [<span class="hljs-string">'parse_lines'</span>, <span class="hljs-string">'language'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next, results</span>) </span>{
        
        scope.render.call(scope, results.parse_lines, results.language, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{

          scope.html = data;
          
          next(err, data);
          
        });
          
      }],
      
      <span class="hljs-attr">write</span>: [<span class="hljs-string">'render'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next, results</span>) </span>{
        
        scope.write.call(scope, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{

          next(err, data);
          
        });
          
      }]
      
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, results</span>) </span>{
      callback(err, scope);
    });
    
  }

  parse(callback) {
    <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.contents) {
      <span class="hljs-keyword">this</span>.parse_file(<span class="hljs-literal">null</span>, <span class="hljs-keyword">this</span>.contents, callback);
    } <span class="hljs-keyword">else</span> {
      fs.readFile(<span class="hljs-keyword">this</span>.filename, <span class="hljs-string">'utf8'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
        scope.parse_file.call(scope, err, data, callback);
      });
    }

  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>And call the above functions. (This is separate so I can split
out &quot;parsing&quot; and &quot;running&quot; in the near future, to allow
inter-file linking, etc.)</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  run(callback) {
    <span class="hljs-keyword">this</span>.parse(callback);
  }
  
}

exports.File = File;</code></pre>
  </div>

  
</section>

      
      
      <section class="section footer" id="footer">
        
        <aside class="comment">
          <span class="content project-copyright">&copy; Copyright 2018 ZLSA Design.</span>
        </aside>

        <div class="code">
          <span class="content page-generation-time">Generated Tue, 10 Jul 2018 18:04:26 GMT</span>
        </div>
        
      </section>
      
    </main>

  </body>
</html>

