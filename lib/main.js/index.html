<!doctype html>
<html>
  <head>
    <title>lib/main.js</title>
    <link rel="stylesheet" href="./../../public/style.css" />
    <link rel="icon" type="image/png" href="./../../public/favicon-32.png" />
    <link rel="icon" type="image/png" href="./../../public/favicon-64.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="./../../public/jquery.min.js"></script>
    <script src="./../../public/script.js"></script>
  </head>
  <body class="code">
    
    <main id="sections">

      <!-- The header -->

        
      <section class="section header files-hidden" id="header">

        <aside class="comment">

          <header>

            <div class="file-path">
              
              
              <a id="project-overview" href="./../.." title="Project Overview">Indoc<span id="version">0.4.19</span></a>
              
              <div class="files-menu">
                <span id="filename" title="lib/main.js">lib/main.js</span>
                
              
                <ul class="files hidable">
                  
                  
<li class="file">
  
<a href="../../CHANGELOG.md" title="CHANGELOG.md">
    
<span class="language" style="background-color: transparent">MD</span>


<span class="filename">CHANGELOG.md</span>

</a>

</li>
  
<li class="file">
  
<a href="../../MARKDOWN.md" title="MARKDOWN.md">
    
<span class="language" style="background-color: transparent">MD</span>


<span class="filename">MARKDOWN.md</span>

</a>

</li>
<li class="file separator">
  
  
<a href="../../bin/main.js" title="bin/main.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">bin/main.js</span>

</a>

</li>
<li class="file separator">
  
  
<a href="../../examples/example.c" title="examples/example.c">
    
<span class="language" style="background-color: #555555">C</span>


<span class="filename">examples/example.c</span>

</a>

</li>
  
<li class="file">
  
<a href="../../examples/example.html" title="examples/example.html">
    
<span class="language" style="background-color: #e44b23">HTML</span>


<span class="filename">examples/example.html</span>

</a>

</li>
  
<li class="file">
  
<a href="../../examples/example-with-really-really-long-filename.java" title="examples/example-with-really-really-long-filename.java">
    
<span class="language" style="background-color: #b07219">java</span>


<span class="filename">examples/example-with-really-really-long-filename.java</span>

</a>

</li>
  
<li class="file">
  
<a href="../../examples/example.js" title="examples/example.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">examples/example.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../../examples/example.md" title="examples/example.md">
    
<span class="language" style="background-color: transparent">MD</span>


<span class="filename">examples/example.md</span>

</a>

</li>
  
<li class="file">
  
<a href="../../examples/example.s" title="examples/example.s">
    
<span class="language" style="background-color: #6E4C13">ASM</span>


<span class="filename">examples/example.s</span>

</a>

</li>
<li class="file separator">
  
  
<a href="../class.js" title="lib/class.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/class.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../events.js" title="lib/events.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/events.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../file.js" title="lib/file.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/file.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../language.js" title="lib/language.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/language.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../section.js" title="lib/section.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/section.js</span>

</a>

</li>
<li class="file separator">
  
  
<a href="../public/script.js" title="lib/public/script.js">
    
<span class="language" style="background-color: #f1e05a">js</span>


<span class="filename">lib/public/script.js</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/code.scss" title="lib/public/code.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/code.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/footer.scss" title="lib/public/footer.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/footer.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/header.scss" title="lib/public/header.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/header.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/markdown.scss" title="lib/public/markdown.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/markdown.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/reset.scss" title="lib/public/reset.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/reset.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/section.scss" title="lib/public/section.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/section.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/style.scss" title="lib/public/style.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/style.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/values.scss" title="lib/public/values.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/values.scss</span>

</a>

</li>
  
<li class="file">
  
<a href="../public/version.scss" title="lib/public/version.scss">
    
<span class="language" style="background-color: #CF649A">SCSS</span>


<span class="filename">lib/public/version.scss</span>

</a>

</li>
<li class="file separator">
  
  
<a href="../template/file.html" title="lib/template/file.html">
    
<span class="language" style="background-color: #e44b23">HTML</span>


<span class="filename">lib/template/file.html</span>

</a>

</li>
  
<li class="file">
  
<a href="../template/link.html" title="lib/template/link.html">
    
<span class="language" style="background-color: #e44b23">HTML</span>


<span class="filename">lib/template/link.html</span>

</a>

</li>
  
<li class="file">
  
<a href="../template/page.html" title="lib/template/page.html">
    
<span class="language" style="background-color: #e44b23">HTML</span>


<span class="filename">lib/template/page.html</span>

</a>

</li>
  
<li class="file">
  
<a href="../template/section.html" title="lib/template/section.html">
    
<span class="language" style="background-color: #e44b23">HTML</span>


<span class="filename">lib/template/section.html</span>

</a>

</li>

                  
                </ul>
                
              </div>
                
            </div>

            <div class="spacer"></div>
            
            
          </header>
            
        </aside>

        
        <div class="code empty">
        </div>

      </section>

      <!-- The main code section -->
      
      <section class="section">

  
  <aside class="comment empty">
    <div class="text markdown"></div>
  </aside>

  <div class="code">
    <pre><code><span class="hljs-meta">'use strict'</span>;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Wow. I require a lot of things here. Without them, I wouldn&#39;t be
happy.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code><span class="hljs-keyword">const</span> fs         = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs-extra'</span>);
<span class="hljs-keyword">const</span> path       = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> merge      = <span class="hljs-built_in">require</span>(<span class="hljs-string">'merge'</span>);
<span class="hljs-keyword">const</span> hogan      = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hogan.js'</span>);
<span class="hljs-keyword">const</span> parallel   = <span class="hljs-built_in">require</span>(<span class="hljs-string">'run-parallel'</span>);
<span class="hljs-keyword">const</span> auto       = <span class="hljs-built_in">require</span>(<span class="hljs-string">'run-auto'</span>);
<span class="hljs-keyword">const</span> glob_copy  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'glob-copy'</span>);
<span class="hljs-keyword">const</span> jsonfile   = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsonfile'</span>);
<span class="hljs-keyword">const</span> glob       = <span class="hljs-built_in">require</span>(<span class="hljs-string">"glob"</span>);

<span class="hljs-keyword">const</span> Events     = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./events'</span>);
<span class="hljs-keyword">const</span> section    = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./section'</span>);
<span class="hljs-keyword">const</span> file       = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./file'</span>);
<span class="hljs-keyword">const</span> language   = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./language'</span>);</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>The project thingy.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Project</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Events</span> </span>{
  
  <span class="hljs-keyword">constructor</span>(options) {

    <span class="hljs-keyword">super</span>();</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>A list of filenames.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">this</span>.filenames = [];</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>A list of files. (See <a href="&#39;../file.js&#39;" title=""><code>file.js</code></a>)</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">this</span>.files = [];</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Merge the options argument with some sane defaults.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">this</span>.options = merge({
      <span class="hljs-attr">name</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">files</span>: [],
      <span class="hljs-attr">ignore</span>: [],
      <span class="hljs-attr">owners</span>: <span class="hljs-string">'contributors'</span>,
      <span class="hljs-attr">output</span>: <span class="hljs-string">'docs'</span>,
      <span class="hljs-attr">readme</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">version</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">links</span>: {},
      <span class="hljs-attr">languages</span>: {}
    }, options);

    <span class="hljs-keyword">this</span>.ignored = [];</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Templates, along with a flag to avoid premature running.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">this</span>.templates = {};
    <span class="hljs-keyword">this</span>.templates_ready = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">this</span>.default_template_data = {
      <span class="hljs-attr">project</span>: <span class="hljs-keyword">this</span>.options.name,
      <span class="hljs-attr">title</span>: <span class="hljs-keyword">this</span>.options.name,
      <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">classes</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">year</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getUTCFullYear(),
      <span class="hljs-attr">owners</span>: <span class="hljs-keyword">this</span>.options.owners,
      <span class="hljs-attr">generate_time</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().toUTCString(),
      <span class="hljs-attr">links</span>: <span class="hljs-keyword">this</span>.options.links
    };</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Gentlemen, prepare your templates!</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">this</span>.prepare_templates();
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>This just reads a file and creates a Hogan template from it.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  prepare_template(filename, callback) {

    fs.readFile(filename, <span class="hljs-string">'utf-8'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>)</span>{
      
      <span class="hljs-keyword">if</span>(err) {
        callback(err, data);
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">var</span> template = hogan.compile(data);

      callback(err, template);
      
    });
  }

  get_file(filename) {
    
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">this</span>.files.length; i++) {
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.files[i].filename == filename) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.files[i];
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>This prepares a list of templates, as well as emitting the proper
events when things happen.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  prepare_templates() {
    <span class="hljs-keyword">var</span> i,
        templates = [
          [<span class="hljs-string">'page'</span>, <span class="hljs-string">'page.html'</span>],
          [<span class="hljs-string">'file'</span>, <span class="hljs-string">'file.html'</span>],
          [<span class="hljs-string">'link'</span>, <span class="hljs-string">'link.html'</span>],
          [<span class="hljs-string">'section'</span>, <span class="hljs-string">'section.html'</span>]
        ];</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>When <code>total == complete</code>, the templates are all loaded.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">var</span> complete = <span class="hljs-number">0</span>,
        total = templates.length;

    <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;templates.length; i++) {</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>New function for the loop.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>      (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, filename</span>) </span>{
        <span class="hljs-keyword">var</span> true_filename = path.join(__dirname, <span class="hljs-string">'template'</span>, filename);
        
        scope.prepare_template.call(scope, true_filename, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, template</span>) </span>{</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Yay, one more done!</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>          complete += <span class="hljs-number">1</span>;

          <span class="hljs-keyword">if</span>(err) {
            scope.emit.call(scope, <span class="hljs-string">'template-err'</span>, { <span class="hljs-attr">filename</span>: true_filename });
          } <span class="hljs-keyword">else</span> {
            scope.templates[name] = template;
            scope.emit.call(scope, <span class="hljs-string">'template-ready'</span>, { <span class="hljs-attr">template</span>: template });
          }
          
          <span class="hljs-keyword">if</span>(complete == total) {
            scope.templates_ready = <span class="hljs-literal">true</span>;
            scope.emit.call(scope, <span class="hljs-string">'templates-ready'</span>);
          }
          
        });
      })(templates[i][<span class="hljs-number">0</span>], templates[i][<span class="hljs-number">1</span>]);
      
    }
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Adds all the filenames to <code>this.filenames</code>, while removing duplicates.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  add_files(files) {
    
    <span class="hljs-keyword">var</span> i;
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;files.length; i++) {
      
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.filenames.indexOf(files[i]) &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.filenames.push(files[i]);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(files[i].startsWith(<span class="hljs-keyword">this</span>.options.output)) {
        <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'recursive-file'</span>, { <span class="hljs-attr">filename</span>: files[i] });
      }
      
    }

  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Replaces <code>this.filenames</code> with the un-globbed version.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  glob_files() {
    <span class="hljs-keyword">var</span> filenames = [], i;

    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">this</span>.filenames.length; i++) {
      filenames.push.apply(filenames, glob.sync(<span class="hljs-keyword">this</span>.filenames[i]));
    }

    <span class="hljs-keyword">this</span>.filenames = filenames;
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Initializes <code>this.ignored</code></p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  glob_ignore(ignore) {
    <span class="hljs-keyword">var</span> filenames = [], i;

    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;ignore.length; i++) {
      filenames.push.apply(filenames, glob.sync(ignore[i]));
    }

    <span class="hljs-keyword">this</span>.ignored = filenames;
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Do I really need to tell you!?</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  sort_files() {</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>This nifty little function returns the directory, the
extension, and then the filename. For example, <code>lib/main.js</code>
will result in <code>lib/.jsmain</code>. This is used to separate
different file types (and avoid <code>script.js</code> and <code>style.css</code>
from being next to each other.)</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">id</span>(<span class="hljs-params">a</span>) </span>{
      <span class="hljs-keyword">var</span> parsed = path.parse(a);
      <span class="hljs-keyword">return</span> parsed.dir + parsed.ext + parsed.name;
    }
    
    <span class="hljs-keyword">this</span>.filenames.sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
      <span class="hljs-keyword">if</span>(id(a) &lt; id(b)) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">if</span>(id(a) &gt; id(b)) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    });
  }

  remove_duplicate_files() {
    <span class="hljs-keyword">var</span> filenames = [];

    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">this</span>.filenames.length; i++) {
      <span class="hljs-keyword">if</span>(filenames.indexOf(<span class="hljs-keyword">this</span>.filenames[i]) &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.filenames[i] == <span class="hljs-keyword">this</span>.options.readme) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'duplicate-file'</span>, { <span class="hljs-attr">filename</span>: <span class="hljs-keyword">this</span>.filenames[i] });
      } <span class="hljs-keyword">else</span> {
        filenames.push(<span class="hljs-keyword">this</span>.filenames[i]);
      }
    }

    <span class="hljs-keyword">this</span>.filenames = filenames;
  }
  
  remove_ignored_files() {
    <span class="hljs-keyword">var</span> filenames = [], i;

    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">this</span>.filenames.length; i++) {
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.ignored.indexOf(<span class="hljs-keyword">this</span>.filenames[i]) &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">continue</span>;
      } <span class="hljs-keyword">else</span> {
        filenames.push(<span class="hljs-keyword">this</span>.filenames[i]);
      }
    }

    <span class="hljs-keyword">this</span>.filenames = filenames;
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Ugh, bad naming. Copies a list of globbed filenames.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  copy(files, callback) {
    <span class="hljs-keyword">if</span>(!<span class="hljs-built_in">Array</span>.isArray(files)) files = [files];
    <span class="hljs-keyword">var</span> total = files.length,
        complete = <span class="hljs-number">0</span>,
        scope = <span class="hljs-keyword">this</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">copy_single_glob</span>(<span class="hljs-params">filename, cb</span>) </span>{

      <span class="hljs-keyword">var</span> src = path.join(__dirname, <span class="hljs-string">'public'</span>, filename),
          dest = path.join(scope.options.output, <span class="hljs-string">'public'</span>);</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Make the directories, first. <code>glob_copy</code> does not like
laziness.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>      fs.mkdirs(dest, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
        glob_copy(src, dest, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, results</span>) </span>{
          cb(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
        });
      });
    }
    
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;files.length; i++) {
      
      copy_single_glob(files[i], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        complete += <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span>(complete == total)
          callback.apply(callback, <span class="hljs-built_in">arguments</span>);
      });
      
    }
  }
  
  copy_css(callback) {
    <span class="hljs-keyword">this</span>.copy(<span class="hljs-string">'style.css'</span>, callback);
  }
  
  copy_images(callback) {
    <span class="hljs-keyword">this</span>.copy(<span class="hljs-string">'*.png'</span>, callback);
  }
  
  copy_js(callback) {
    <span class="hljs-keyword">this</span>.copy(<span class="hljs-string">'*.js'</span>, callback);
  }
  
  copy_fonts(callback) {
    <span class="hljs-keyword">this</span>.copy([<span class="hljs-string">'*.eot'</span>, <span class="hljs-string">'*.woff'</span>], callback);
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Calls the above four functions in parallel, then calls the
callback when they&#39;re all done.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  copy_public(callback) {
    <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>;
    
    parallel([
      
      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        scope.copy_js.call(scope, next);
      },

      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        scope.copy_css.call(scope, next);
      },
      
      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        scope.copy_fonts.call(scope, next);
      },
      
      <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        scope.copy_images.call(scope, next);
      }
    ], callback);
    
  }

  each_file(func, callback) {
    
    <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>,
        total = <span class="hljs-keyword">this</span>.files.length,
        complete = <span class="hljs-number">0</span>,
        errors = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">var</span> i;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Inline functions to reduce complexity in the loop.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run_complete</span>(<span class="hljs-params"></span>) </span>{
      callback({
        <span class="hljs-attr">total</span>: total,
        <span class="hljs-attr">complete</span>: complete,
        <span class="hljs-attr">errors</span>: errors
      });
    }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Called when a single file is complete.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">file_complete</span>(<span class="hljs-params">err, data</span>) </span>{
      <span class="hljs-keyword">if</span>(err) errors += <span class="hljs-number">1</span>;
      complete += <span class="hljs-number">1</span>;</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>WE ARE DONE! YAY! WOOHOO!</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>      <span class="hljs-keyword">if</span>(total == complete) run_complete();
    };</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>The loop is nice and tiny, just like a loop should be.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">this</span>.files.length; i++) {
      func(<span class="hljs-keyword">this</span>.files[i], file_complete);
    }

  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>For each file, run it.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  run_files(callback) {

    <span class="hljs-keyword">var</span> i, f;

    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.options.readme) {
      <span class="hljs-keyword">this</span>.add_files([<span class="hljs-keyword">this</span>.options.readme]);
    }
    
    <span class="hljs-keyword">this</span>.glob_ignore(<span class="hljs-keyword">this</span>.options.ignore);
    
    <span class="hljs-keyword">this</span>.add_files(<span class="hljs-keyword">this</span>.options.files);

    <span class="hljs-keyword">this</span>.glob_files();
    
    <span class="hljs-keyword">this</span>.remove_duplicate_files();
    <span class="hljs-keyword">this</span>.remove_ignored_files();
    
    <span class="hljs-keyword">this</span>.sort_files();

    <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>,
        total = <span class="hljs-keyword">this</span>.filenames.length + <span class="hljs-number">1</span>,
        complete = <span class="hljs-number">1</span>,
        errors = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.filenames.length == <span class="hljs-number">0</span>) {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'! no files to parse'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">this</span>.filenames.length; i++) {
      f = <span class="hljs-keyword">new</span> file.File(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.filenames[i]);
      <span class="hljs-keyword">this</span>.files.push(f);
    }

    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.options.readme) {
      f = <span class="hljs-keyword">new</span> file.File(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.options.readme);
      f.index = <span class="hljs-literal">true</span>;
      f.path = <span class="hljs-string">''</span>;
      <span class="hljs-keyword">this</span>.files.push(f);</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>If there&#39;s no readme file, provide our own</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>    } <span class="hljs-keyword">else</span> {
      f = <span class="hljs-keyword">new</span> file.File(<span class="hljs-keyword">this</span>, <span class="hljs-string">'README.default.md'</span>, [
        <span class="hljs-string">'# No `README` was provided'</span>,
        <span class="hljs-string">'(hint: use the `readme` option in the JSON configuration file to set your own `README` file)'</span>
      ].join(<span class="hljs-string">'\n'</span>));
      
      f.index = <span class="hljs-literal">true</span>;
      f.path = <span class="hljs-string">''</span>;
      <span class="hljs-keyword">this</span>.files.push(f);
    }

    <span class="hljs-keyword">this</span>.each_file(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">file, callback</span>) </span>{
      
      file.run(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
        scope.emit.call(scope, <span class="hljs-string">'run-file-complete'</span>, { <span class="hljs-attr">err</span>: err, <span class="hljs-attr">data</span>: data });
        callback(err, data);
      });
      
    }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>{
      scope.emit.call(scope, <span class="hljs-string">'run-complete'</span>, data);

      <span class="hljs-keyword">if</span>(callback) {
        callback(<span class="hljs-literal">null</span>, data);
      }
    });

    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Returns a list of all the filenames and link URLs (used to create
the file listing in the sidebar.)</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  get_link_filenames(file) {

    <span class="hljs-keyword">var</span> i, filenames=[], last_path_dir;
    
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i&lt;<span class="hljs-keyword">this</span>.files.length; i++) {</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Used to avoid duplicated files.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.files[i] === file) <span class="hljs-keyword">continue</span>;

      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.files[i].filename === <span class="hljs-keyword">this</span>.options.readme) <span class="hljs-keyword">continue</span>;
      
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.files[i].index) <span class="hljs-keyword">continue</span>;
      
      <span class="hljs-keyword">var</span> lang = language.get_language(path.extname(<span class="hljs-keyword">this</span>.files[i].filename).substr(<span class="hljs-number">1</span>), {});
      <span class="hljs-keyword">if</span>(lang[<span class="hljs-number">1</span>] === <span class="hljs-string">'auto'</span>) lang = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">else</span>                  lang = lang[<span class="hljs-number">0</span>];
      
      filenames.push({
        <span class="hljs-attr">filename</span>: <span class="hljs-keyword">this</span>.files[i].filename,
        <span class="hljs-attr">link</span>: path.relative(file.get_link(), <span class="hljs-keyword">this</span>.files[i].get_link()),
        <span class="hljs-attr">separator</span>: ((path.dirname(<span class="hljs-keyword">this</span>.files[i].filename) != last_path_dir) &amp;&amp; filenames.length ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>),
        <span class="hljs-attr">language</span>: (lang ? lang.name.abbr : <span class="hljs-literal">null</span>),
        <span class="hljs-attr">color</span>: (lang ? lang.color : <span class="hljs-string">'#f0f'</span>)
      });

      last_path_dir = path.dirname(<span class="hljs-keyword">this</span>.files[i].filename);
      
    }

    <span class="hljs-keyword">return</span> filenames;
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>Copies the files and generates the overview, thanks to <code>run-auto</code>.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  _run(callback) {

    <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>;
    
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">r</span>(<span class="hljs-params"></span>) </span>{
      
      auto({
        
        <span class="hljs-attr">files</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
          scope.run_files.call(scope, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
            next(err, data);
          });
        },
        
        <span class="hljs-attr">copy</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
          scope.copy_public.call(scope, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
            next(err, data);
          });
        }
        
      }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, results</span>) </span>{
        callback(err, results.files);
      });
    }

    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.options.version == <span class="hljs-string">'package.json'</span>) {
      
      jsonfile.readFile(<span class="hljs-string">'package.json'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, data</span>) </span>{
        
        <span class="hljs-keyword">if</span>(err || !(<span class="hljs-string">'version'</span> <span class="hljs-keyword">in</span> data)) {
          scope.emit.call(<span class="hljs-string">'package-json-err'</span>);
          <span class="hljs-keyword">return</span>;
        }
        
        scope.options.version = data.version;
        
        r();
        
      });
      
    } <span class="hljs-keyword">else</span> {
      r();
    }
             
  }</code></pre>
  </div>

  
</section>
<section class="section">

  <aside class="comment">
    <div class="text markdown"><p>A wrapper, to avoid running before the templates are completely
loaded.</p>
</div>
  </aside>
  

  <div class="code">
    <pre><code>  run(callback) {
    
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.templates_ready) {
      
      <span class="hljs-keyword">this</span>._run(callback);
      
    } <span class="hljs-keyword">else</span> {
      
      <span class="hljs-keyword">var</span> scope = <span class="hljs-keyword">this</span>;
      
      <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'templates-ready'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        scope._run.call(scope, callback);
      });
      
    }
    
  }
  
}

exports.Project = Project;

exports.project = {
  <span class="hljs-attr">create</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Project(options);
  }
};</code></pre>
  </div>

  
</section>

      
      
      <section class="section footer" id="footer">
        
        <aside class="comment">
          <span class="content project-copyright">&copy; Copyright 2018 ZLSA Design.</span>
        </aside>

        <div class="code">
          <span class="content page-generation-time">Generated Tue, 10 Jul 2018 18:04:26 GMT</span>
        </div>
        
      </section>
      
    </main>

  </body>
</html>

